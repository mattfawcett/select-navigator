// Generated by CoffeeScript 1.3.3
(function() {
  var SelectNavigator;

  SelectNavigator = (function() {

    function SelectNavigator(select) {
      var _this = this;
      select.data('select-navigator', this);
      this.defaultMethod = select.data('method') || 'get';
      select.bind('change', function(e) {
        var method, selectedOption, url;
        selectedOption = select.find('option:selected');
        url = selectedOption.val();
        method = selectedOption.data('method') || _this.defaultMethod;
        if (method === 'get') {
          return _this.doRedirect(url);
        } else {
          return _this.doFormSubmission(url, method);
        }
      });
    }

    SelectNavigator.prototype.doRedirect = function(url) {
      return window.location = url;
    };

    SelectNavigator.prototype.doFormSubmission = function(url, method) {
      return this.buildForm(url, method).submit();
    };

    SelectNavigator.prototype.buildForm = function(url, method) {
      var form;
      form = $("<form/>", {
        method: 'post',
        action: url
      });
      if (method !== 'post') {
        form.append($('<input/>', {
          type: 'hidden',
          name: '_method',
          value: method
        }));
      }
      if (this.csrfParamName() && this.csrfToken()) {
        form.append($('<input/>', {
          type: 'hidden',
          name: this.csrfParamName(),
          value: this.csrfToken()
        }));
      }
      return form;
    };

    SelectNavigator.prototype.csrfParamName = function() {
      return $('meta[name="csrf-param"]').attr('content');
    };

    SelectNavigator.prototype.csrfToken = function() {
      return $('meta[name="csrf-token"]').attr('content');
    };

    return SelectNavigator;

  })();

  jQuery.fn.extend({
    selectNavigator: function() {
      return new SelectNavigator(this);
    }
  });

}).call(this);
